============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/users/duynguy/proj/sql_exev
configfile: pyproject.toml
plugins: anyio-4.11.0
collecting ... collected 6 items

tests/test_golden_set.py::test_golden_set[01_composite_index] FAILED

=================================== FAILURES ===================================
_____________________ test_golden_set[01_composite_index] ______________________

test_name = '01_composite_index'

    @requires_db
    @requires_llm
    @pytest.mark.golden
    @pytest.mark.parametrize("test_name", list(VILLAIN_QUERIES.keys()))
    def test_golden_set(test_name: str):
        spec = VILLAIN_QUERIES[test_name]
        result = run_exev_gauntlet(spec["sql"])
    
        fb = result.get("feedback", {})
        status = (fb.get("status") or "").lower()
        suggestion = fb.get("suggestion", "") or ""
    
        # 1) Status check
        assert status == spec["expected_status"], (
            f"[{test_name}] Expected status '{spec['expected_status']}', got '{status}'\n"
            f"Reason: {fb.get('reason')}\nSuggestion: {suggestion}"
        )
    
        # 2) Suggestion contains expected fragments
        for frag in spec.get("expected_suggestion_includes", []):
>           assert frag in suggestion, (
                f"[{test_name}] Suggestion did not include '{frag}'.\n"
                f"Suggestion: {suggestion}"
            )
E           AssertionError: [01_composite_index] Suggestion did not include 'o_orderstatus'.
E             Suggestion: CREATE INDEX idx_orders_composite ON orders(o_custkey, AND);
E           assert 'o_orderstatus' in 'CREATE INDEX idx_orders_composite ON orders(o_custkey, AND);'

tests/test_golden_set.py:124: AssertionError
=========================== short test summary info ============================
FAILED tests/test_golden_set.py::test_golden_set[01_composite_index] - Assert...
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
============================== 1 failed in 4.32s ===============================
